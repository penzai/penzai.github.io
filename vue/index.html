<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue | Study Note</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="学无止境">
    <link rel="preload" href="/assets/css/0.styles.abfd12c2.css" as="style"><link rel="preload" href="/assets/js/app.36ad382c.js" as="script"><link rel="preload" href="/assets/js/2.a1ac94cf.js" as="script"><link rel="preload" href="/assets/js/19.07ebb6bd.js" as="script"><link rel="prefetch" href="/assets/js/10.b6996d25.js"><link rel="prefetch" href="/assets/js/11.b0661856.js"><link rel="prefetch" href="/assets/js/12.cf1bf860.js"><link rel="prefetch" href="/assets/js/13.13dfa2d2.js"><link rel="prefetch" href="/assets/js/14.ec039f46.js"><link rel="prefetch" href="/assets/js/15.1f2f5719.js"><link rel="prefetch" href="/assets/js/16.ed05caeb.js"><link rel="prefetch" href="/assets/js/17.e60d8d3a.js"><link rel="prefetch" href="/assets/js/18.0fb7c1b5.js"><link rel="prefetch" href="/assets/js/20.e89d52a2.js"><link rel="prefetch" href="/assets/js/3.93bd9308.js"><link rel="prefetch" href="/assets/js/4.fde1b9ea.js"><link rel="prefetch" href="/assets/js/5.90e610a4.js"><link rel="prefetch" href="/assets/js/6.3272386e.js"><link rel="prefetch" href="/assets/js/7.6e03230f.js"><link rel="prefetch" href="/assets/js/8.d3db6f3f.js"><link rel="prefetch" href="/assets/js/9.f2880887.js">
    <link rel="stylesheet" href="/assets/css/0.styles.abfd12c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Study Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/js/" class="sidebar-link">Javascript</a></li><li><a href="/css/" class="sidebar-link">CSS 基础</a></li><li><a href="/css-practice/" class="sidebar-link">CSS 应用</a></li><li><a href="/dac/" class="sidebar-link">数据结构与算法</a></li><li><a href="/web/" class="sidebar-link">Web 与网络</a></li><li><a href="/git/" class="sidebar-link">git</a></li><li><a href="/linux/" class="sidebar-link">Linux</a></li><li><a href="/nginx/" class="sidebar-link">Nginx</a></li><li><a href="/node/" class="sidebar-link">node</a></li><li><a href="/react/" class="sidebar-link">React</a></li><li><a href="/vue/" aria-current="page" class="active sidebar-link">Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue/#vue源码" class="sidebar-link">vue源码</a></li><li class="sidebar-sub-header"><a href="/vue/#virtual-dom" class="sidebar-link">Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/vue/#生命周期" class="sidebar-link">生命周期</a></li><li class="sidebar-sub-header"><a href="/vue/#响应式原理" class="sidebar-link">响应式原理</a></li><li class="sidebar-sub-header"><a href="/vue/#插槽" class="sidebar-link">插槽</a></li><li class="sidebar-sub-header"><a href="/vue/#函数式组件" class="sidebar-link">函数式组件</a></li><li class="sidebar-sub-header"><a href="/vue/#组件通信方式" class="sidebar-link">组件通信方式</a></li><li class="sidebar-sub-header"><a href="/vue/#render" class="sidebar-link">render</a></li><li class="sidebar-sub-header"><a href="/vue/#composition-api" class="sidebar-link">Composition API</a></li><li class="sidebar-sub-header"><a href="/vue/#vuex" class="sidebar-link">vuex</a></li><li class="sidebar-sub-header"><a href="/vue/#vue-router" class="sidebar-link">vue-router</a></li><li class="sidebar-sub-header"><a href="/vue/#echarts" class="sidebar-link">echarts</a></li><li class="sidebar-sub-header"><a href="/vue/#mock" class="sidebar-link">mock</a></li><li class="sidebar-sub-header"><a href="/vue/#vue-cli-脚手架使用注意" class="sidebar-link">vue-cli 脚手架使用注意</a></li><li class="sidebar-sub-header"><a href="/vue/#踩坑" class="sidebar-link">踩坑</a></li></ul></li><li><a href="/write/" class="sidebar-link">js 手写系列</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h1> <h2 id="vue源码"><a href="#vue源码" class="header-anchor">#</a> vue源码</h2> <h3 id="优雅的地方"><a href="#优雅的地方" class="header-anchor">#</a> 优雅的地方</h3> <ul><li>对于要收集的依赖，挂载到Dep.target上，避免了全局变量的使用</li> <li>没有在每个依赖发生的具体地方直接赋值Dep.target来进行依赖收集，而是建立了Watcher类来统一管理并归类所有依赖</li></ul> <h3 id="设计模式"><a href="#设计模式" class="header-anchor">#</a> 设计模式</h3> <h4 id="发布订阅模式"><a href="#发布订阅模式" class="header-anchor">#</a> 发布订阅模式</h4> <ul><li>发布者</li> <li>订阅者</li> <li>信号中心</li></ul> <p>vue中的自定义事件以及node中的事件机制都是基于此模式。</p> <h4 id="观察者模式"><a href="#观察者模式" class="header-anchor">#</a> 观察者模式</h4> <p>响应式机制运用了观察者模式。</p> <ul><li>发布者（目标）</li> <li>订阅者（观察者）</li></ul> <p>发布订阅模式通过信号中心统一调度，观察者模式通过发布者自己触发订阅者的行为（互相依赖性更强）。</p> <h2 id="virtual-dom"><a href="#virtual-dom" class="header-anchor">#</a> Virtual DOM</h2> <p>DOM对象很庞大，创建代价高，所以就由普通的js对象来描述DOM对象。</p> <p>DOM频繁操作还会引起性能问题，于是把一系列操作改成立即操作VirtualDOM，最终通过diff算法，来进行比对前后的VirtualDOM区别，来进行有效的更新DOM。</p> <blockquote><p>diff算法只针对于同级</p></blockquote> <blockquote><p>某些简单情况，使用VirtualDOM还会变慢（多了创建和比对步骤）。</p></blockquote> <h4 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h4> <p>跨平台（移动端、小程序）、SSR</p> <h3 id="diff算法"><a href="#diff算法" class="header-anchor">#</a> diff算法</h3> <p>对于识别出来的不同元素，算法并不会单纯的把原来的删除，然后建立新的，而是会重用dom本身，再进行一些数据设置，所以当一个dom的其它特性被修改时，又没有跟数据本身关联（比如checked效果、你自己设置的dom属性），那么重用的元素依然保留该效果。</p> <p>例如一个没有设置key的li列表，当list数据变化时，checkbox的勾选状态并不会跟着数据走，如果是第一个li标签，就一直是第一个li标签被选中。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;ul&gt;
  &lt;li v-for=&quot;item in list&quot;&gt;
    &lt;input type=&quot;checkbox&quot;&gt;
    {{ item }}
  &lt;/li&gt;
&lt;/ul&gt;
</code></pre></div><blockquote><p>所以在动态子节点中，一个独立的key尤为重要！！！</p></blockquote> <h2 id="生命周期"><a href="#生命周期" class="header-anchor">#</a> 生命周期</h2> <h3 id="创建阶段"><a href="#创建阶段" class="header-anchor">#</a> 创建阶段</h3> <ul><li><code>beforeCreate</code> 钩子</li> <li>injections ➡️prop ➡️methods ➡️data ➡️computed ➡️ watch ➡️ provide</li> <li><code>created</code></li> <li>模板编译到 render 函数(vNode)
<blockquote><p>注：这个时候还未执行模板里的代码，只是编译成 render 函数。如果写了 render 函数，那么自动跳过这一步。</p></blockquote></li> <li><code>beforeMount</code> 钩子</li> <li>render 函数代码执行</li> <li><code>mounted</code> 钩子</li></ul> <h3 id="更新阶段"><a href="#更新阶段" class="header-anchor">#</a> 更新阶段</h3> <ul><li>依赖变更(或者执行<code>$forceUpdate</code>方法)</li> <li><code>beforeUpdate</code></li> <li>render 函数代码执行</li> <li><code>updated</code></li></ul> <h3 id="销毁阶段"><a href="#销毁阶段" class="header-anchor">#</a> 销毁阶段</h3> <ul><li><code>beforeDestroy</code></li> <li><code>destroyed</code></li></ul> <h3 id="父子组件的生命周期"><a href="#父子组件的生命周期" class="header-anchor">#</a> 父子组件的生命周期</h3> <ul><li>父组件会等待子组件挂载</li> <li>当子组件完成挂载后，父组件会主动执行一次 beforeUpdate/updated 钩子函数</li></ul> <h2 id="响应式原理"><a href="#响应式原理" class="header-anchor">#</a> 响应式原理</h2> <h3 id="dep-与-watcher"><a href="#dep-与-watcher" class="header-anchor">#</a> Dep 与 Watcher</h3> <p>Dep 即收集器，发布类。负责收集和分发，拥有属性 id/subs，depend 方法即调用 Watcher 实例的 addDep 方法去收集，notify 方法即调用 Watcher 实例的 update 方法</p> <p>Watcher 即订阅类。实例拥有若干属性，比较重要的有 vm/getter/lazy。</p> <h3 id="处理-data"><a href="#处理-data" class="header-anchor">#</a> 处理 data</h3> <p>观察对象，使用<code>observe(data)</code>。给此对象增加<strong>ob</strong>属性，值为 Observer 实例，该实例拥有属性 value/vmCount/新创建的 dep，在该实例创建过程中会对 data 的每一个属性进行 getter 和 setter 方法劫持。get 方法中，如果有 Dep.target 那么就调用 dep.depend()进行依赖收集，set 方法中调用 dep.notify()进行通知分发。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val<span class="token punctuation">;</span>
    <span class="token comment">/* eslint-disable no-self-compare */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">===</span> value <span class="token operator">||</span> <span class="token punctuation">(</span>newVal <span class="token operator">!==</span> newVal <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/* eslint-enable no-self-compare */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">&amp;&amp;</span> customSetter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">customSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// #7981: for accessor properties without setter</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>getter <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>setter<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>???为什么收集是在单个属性接管时，建立的 dep 实例中去收集。</p></blockquote> <h3 id="处理-computed"><a href="#处理-computed" class="header-anchor">#</a> 处理 computed</h3> <p>每个属性，都会定义在 vm 上，getter 方法为如下。在这之前，会把用户定义的函数 userDef，通过 new Watcher 创建实例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">computedGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> watcher <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_computedWatchers<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>dirty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      watcher<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> watcher<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="处理-watch"><a href="#处理-watch" class="header-anchor">#</a> 处理 watch</h3> <h3 id="vue3-0响应式（使用proxy）"><a href="#vue3-0响应式（使用proxy）" class="header-anchor">#</a> vue3.0响应式（使用proxy）</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> effects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> proxyHandler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 收集依赖</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>effects<span class="token punctuation">.</span>last<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 确保当前这个对象下这个属性所对应依赖列表</span>
      effects<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token operator">...</span>effects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 记录依赖</span>
      effects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>effects<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> succeed <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> deps <span class="token operator">=</span> effects<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">[</span>property<span class="token punctuation">]</span><span class="token punctuation">;</span>
    deps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> succeed<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 为每个对象记录映射一个依赖列表对象（这是使用map可以识别出记录过的对象）</span>
  effects<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 复用proxyHandler，减少内存消耗</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> proxyHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token parameter">effect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 挂载即将要处理的依赖</span>
  effects<span class="token punctuation">.</span>last <span class="token operator">=</span> effect<span class="token punctuation">;</span>
  <span class="token function">effect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  effects<span class="token punctuation">.</span>last <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  foo<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  bar<span class="token operator">:</span> <span class="token number">200</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo changed&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;bar changed&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">.</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

state<span class="token punctuation">.</span>foo<span class="token operator">++</span><span class="token punctuation">;</span>
state<span class="token punctuation">.</span>bar<span class="token operator">++</span><span class="token punctuation">;</span>
</code></pre></div><p>直接调用 vm.$watch()</p> <h2 id="插槽"><a href="#插槽" class="header-anchor">#</a> 插槽</h2> <ul><li>slot 合并</li> <li>v-slot 替换</li> <li>slot + slot-scope 替换</li></ul> <h2 id="函数式组件"><a href="#函数式组件" class="header-anchor">#</a> 函数式组件</h2> <ul><li>无状态、无实例、没有 this 上下文、无生命周期</li> <li>一般作展示用</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// vnodes 传入jsx代码</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    VNodes<span class="token operator">:</span> <span class="token punctuation">{</span>
      functional<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span>props<span class="token punctuation">.</span>vnodes
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="组件通信方式"><a href="#组件通信方式" class="header-anchor">#</a> 组件通信方式</h2> <ul><li>props、$emit</li> <li>$attrs、$listeners</li> <li>EventBus</li> <li>provide、inject</li> <li>v-model</li> <li>$parent、$children</li> <li>$broadcast、$dispatch</li> <li>vuex</li></ul> <h2 id="render"><a href="#render" class="header-anchor">#</a> render</h2> <blockquote><p>更抽象一点来看，我们可以把组件区分为两类：一类是偏视图表现的 (presentational)，一类则是偏逻辑的 (logical)。我们推荐在前者中使用模板，在后者中使用 JSX 或渲染函数。这两类组件的比例会根据应用类型的不同有所变化，但整体来说我们发现表现类的组件远远多于逻辑类组件。</p></blockquote> <h2 id="composition-api"><a href="#composition-api" class="header-anchor">#</a> Composition API</h2> <p>使用setup函数包装所有逻辑操作，返回<strong>模板</strong>要使用的或者<strong>其他逻辑处</strong>要使用的对象集合（响应式的对象）。</p> <h2 id="vuex"><a href="#vuex" class="header-anchor">#</a> vuex</h2> <p>模块记得开启命名空间。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>modules<span class="token operator">:</span> <span class="token punctuation">{</span>
    namespaced<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    state<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    getters<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue-router"><a href="#vue-router" class="header-anchor">#</a> vue-router</h2> <ul><li><code>routes</code>第一层的<code>path</code>必须加<code>/</code>符号，或者为<code>''</code>，代表默认路径。</li> <li>匹配路由时，当匹配到第一个时，就停止。</li> <li>同时设置<code>redirect</code>和<code>{ children: { path: '' }}</code>时，将无视前者。
<blockquote><p>先匹配后计算</p></blockquote></li></ul> <h2 id="echarts"><a href="#echarts" class="header-anchor">#</a> echarts</h2> <ol><li><p>使用 this.$refs.xxx 获取 dom，而不使用 document.getElementById('xxx)</p></li> <li><p>图表的 chart.resize()功能提取为单独函数，使用 resize-detector 库的 addListener 进行绑定和 removeListener 取消绑绑定，且使用 debounce 进行防抖处理(可在 created 生命周期里对 vue 组件的 methods 中的方法进行改造)</p></li> <li><p>不要忘记在 beforeDestroy 生命周期里解绑事件，以及使用 chart.dispose()图表</p></li></ol> <h2 id="mock"><a href="#mock" class="header-anchor">#</a> mock</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code> proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      target<span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000&quot;</span>
      <span class="token function-variable function">bypass</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>accept<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Skipping proxy for browser request.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MOCK</span> <span class="token operator">!==</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> name <span class="token operator">=</span> req<span class="token punctuation">.</span>path
            <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/api/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> mock <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./mock/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">mock</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">delete</span> require<span class="token punctuation">.</span>cache<span class="token punctuation">[</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./mock/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="vue-cli-脚手架使用注意"><a href="#vue-cli-脚手架使用注意" class="header-anchor">#</a> vue-cli 脚手架使用注意</h2> <h3 id="自动格式化"><a href="#自动格式化" class="header-anchor">#</a> 自动格式化</h3> <p>默认的错误警告提示只在命令行显示，且格式化需要手动运行<code>yarn lint</code>。</p> <p>自动操作如下：</p> <ul><li>安装 eslint 插件</li> <li>配置</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 打开保存时自动格式化，在vue文件中与autoFix属性缺一不可</span>
  <span class="token property">&quot;eslint.autoFixOnSave&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 需要调用eslint的文件类型</span>
  <span class="token property">&quot;eslint.validate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;javascript&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;javascriptreact&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;language&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;autoFix&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>建议规则配置操作，修改<code>.eslintrc.js</code>：</p> <ul><li>extends 字段中的<code>&quot;plugin:vue/essential&quot;</code> 改为<code>&quot;plugin:vue/recommended&quot;</code></li> <li>rules 字段中添加如下忽略规则：
<ul><li>&quot;vue/require-default-prop&quot;: &quot;off&quot;</li></ul></li></ul> <h2 id="踩坑"><a href="#踩坑" class="header-anchor">#</a> 踩坑</h2> <ul><li>props 传递的数据，如果不是在原对象上面修改，那么直接紧接着使用<code>this.$refs.xxx.xxx()</code>方法里面访问到的还是旧值。需要使用<code>this.$nextTick()</code>;</li> <li>props 传递为 null 时既不会触发 default 操作，也不会触发validator操作,同理在函数默认赋值时<code>function(a = 1){}</code>，传null也不会触发。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react/" class="prev">
        React
      </a></span> <span class="next"><a href="/write/">
        js 手写系列
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.36ad382c.js" defer></script><script src="/assets/js/2.a1ac94cf.js" defer></script><script src="/assets/js/19.07ebb6bd.js" defer></script>
  </body>
</html>

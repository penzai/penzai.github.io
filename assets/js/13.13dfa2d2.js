(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{360:function(t,a,s){"use strict";s.r(a);var e=s(42),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"自动注入样式变量、mixins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动注入样式变量、mixins"}},[t._v("#")]),t._v(" 自动注入样式变量、mixins")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("style-resources-loader")]),t._v("包，配置 webpack 如下：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.less$/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"style-loader"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"css-loader"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"less-loader"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            loader"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"style-resources-loader"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            options"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              patterns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                __dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"path/to/less/variables/*.less"')]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n              injector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"append"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"关于vue-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关于vue-cli"}},[t._v("#")]),t._v(" 关于"),s("code",[t._v("vue-cli")])]),t._v(" "),s("h3",{attrs:{id:"通过mode设置不同版本差异"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过mode设置不同版本差异"}},[t._v("#")]),t._v(" 通过mode设置不同版本差异")]),t._v(" "),s("p",[t._v("根目录建立"),s("code",[t._v(".env.模式名称1")]),t._v("文件。")]),t._v(" "),s("p",[t._v("即可在命令"),s("code",[t._v("vue-cli-service serve -mode 模式名称1")]),t._v("启用相应的配置文件。")]),t._v(" "),s("p",[t._v("这里的mode要注意与webpack的NODE_ENV区分，NODE_ENV是打包必须的一个变量，而"),s("code",[t._v("vue-cli-service")]),t._v("的mode只是决定使用哪个变量文件。")]),t._v(" "),s("p",[t._v("如果自定义的变量文件不指定NODE_ENV，那么"),s("code",[t._v("vue-cli-service serve")]),t._v("的NODE_ENV默认development，build命令默认production。")]),t._v(" "),s("h3",{attrs:{id:"图片等资源引入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#图片等资源引入"}},[t._v("#")]),t._v(" 图片等资源引入")]),t._v(" "),s("ul",[s("li",[t._v("template\n"),s("ul",[s("li",[t._v("相对路径，经过webpack处理")]),t._v(" "),s("li",[t._v("绝对路径，不处理，路径原封不动")])])]),t._v(" "),s("li",[t._v("javascript\n"),s("ul",[s("li",[t._v("相对路径，经过webpack处理")]),t._v(" "),s("li",[t._v("绝对路径，经过webpack处理")])])]),t._v(" "),s("li",[t._v("style\n"),s("ul",[s("li",[t._v("相对路径，经过loader处理")]),t._v(" "),s("li",[t._v("绝对路径，经常loader处理，~符号由webpack处理")])])]),t._v(" "),s("li",[t._v("css属性\n"),s("ul",[s("li",[t._v("相对路径，经过webpack处理")]),t._v(" "),s("li",[t._v("绝对路径，不处理，路径原封不动")])])])]),t._v(" "),s("h2",{attrs:{id:"异常监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异常监控"}},[t._v("#")]),t._v(" 异常监控")]),t._v(" "),s("h3",{attrs:{id:"代码监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码监控"}},[t._v("#")]),t._v(" 代码监控")]),t._v(" "),s("p",[t._v("通过上传堆栈信息然后根据map文件定位具体代码位置。")]),t._v(" "),s("h4",{attrs:{id:"捕获报错信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#捕获报错信息"}},[t._v("#")]),t._v(" 捕获报错信息")]),t._v(" "),s("ul",[s("li",[t._v("window.onerror")]),t._v(" "),s("li",[t._v("vue中使用全局配置"),s("code",[t._v("Vue.config.errorHandler")])])]),t._v(" "),s("h4",{attrs:{id:"堆栈信息优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#堆栈信息优化"}},[t._v("#")]),t._v(" 堆栈信息优化")]),t._v(" "),s("ul",[s("li",[t._v("构建map文件在另一台机器上")]),t._v(" "),s("li",[t._v("优化文本量大\n"),s("ul",[s("li",[t._v("重复内容采用简洁标识替代，比如URL")])])]),t._v(" "),s("li",[t._v("优化重复堆栈，每个堆栈计算一个ID")])]),t._v(" "),s("blockquote",[s("p",[t._v("将堆栈按一个稳定的算法提取其中若干行，拼接起来作为指纹，然后使用 MD5 算出一个固定位数的 hash 作为 ID。")])]),t._v(" "),s("h4",{attrs:{id:"探测堆栈是否上报过"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#探测堆栈是否上报过"}},[t._v("#")]),t._v(" 探测堆栈是否上报过")]),t._v(" "),s("p",[t._v("（不是很理解，来源互联网）")]),t._v(" "),s("p",[t._v("有了 ID 之后，我们还要探测这个 ID 的堆栈是否上报过，最简单的方式其实是请求服务端接口查询一下，但对于大部分服务端接口都难以承载堆栈探测这种量级的请求。所以我们采用了一个比较机智的方法来完成堆栈上报的探测。")]),t._v(" "),s("p",[t._v("当服务端接收到某个堆栈后，会往 CDN 发一个带有堆栈 ID 的空文件。而采集脚本发生异常，获取到 ID 时会用ID 去访问 CDN 资源，如果请求成功，说明堆栈上报过，就不再上报；如果是 404，则说明是全新的堆栈，需要进行上报。CDN 本身设计上就是能够承载大量访问的，因此就解决了探测的问题。")]),t._v(" "),s("h4",{attrs:{id:"映射代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#映射代码"}},[t._v("#")]),t._v(" 映射代码")]),t._v(" "),s("p",[t._v("使用npm包"),s("code",[t._v("source-map")])]),t._v(" "),s("h3",{attrs:{id:"数据监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据监控"}},[t._v("#")]),t._v(" 数据监控")]),t._v(" "),s("p",[t._v("上报一些自定义数据，可以进行维度分析，进而找到问题的集中发生点。")]),t._v(" "),s("h3",{attrs:{id:"用户操作监控"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用户操作监控"}},[t._v("#")]),t._v(" 用户操作监控")]),t._v(" "),s("p",[t._v("与埋点系统结合，找到异常出现的用户前几步操作，以此重现问题")]),t._v(" "),s("h3",{attrs:{id:"变更"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#变更"}},[t._v("#")]),t._v(" 变更")]),t._v(" "),s("p",[t._v("通过异常出现时间的代码整体变动来进行分析，常见的就是代码的某个发版")]),t._v(" "),s("h3",{attrs:{id:"自动接入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动接入"}},[t._v("#")]),t._v(" 自动接入")]),t._v(" "),s("p",[t._v("研发平台将监控的项目 ID 注入到构建容器中，然后构建工具去获取参数，并将脚本和参数注入到前端构建产物中。")])])}),[],!1,null,null,null);a.default=n.exports}}]);